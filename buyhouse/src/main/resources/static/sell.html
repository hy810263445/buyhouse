<!doctype html>
<html lang="en">

<head>
    <title>Buyhouse</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
    <script src="http://i.gtimg.cn/qzone/biz/gdt/lib/jquery/jquery-2.1.4.js?max_age=31536000"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        li {
            list-style: none;
        }

        /*引入阿里的icon*/

        @font-face {
            font-family: "iconfont";
            src: url('iconfont.eot?t=1534844614970');
            /* IE9*/
            src: url('iconfont.eot?t=1534844614970#iefix') format('embedded-opentype'),
                /* IE6-IE8 */
                url('data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAATgAAsAAAAAB1AAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFY8qEgkY21hcAAAAYAAAABLAAABcOdatkBnbHlmAAABzAAAASwAAAFY2/C2dWhlYWQAAAL4AAAALwAAADYSY0OKaGhlYQAAAygAAAAcAAAAJAfeA4NobXR4AAADRAAAAAgAAAAICAAAAGxvY2EAAANMAAAABgAAAAYArAAAbWF4cAAAA1QAAAAgAAAAIAEPAH1uYW1lAAADdAAAAUUAAAJtPlT+fXBvc3QAAAS8AAAAIwAAADQ9SsrveJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkYWCcwMDKwMHUyXSGgYGhH0IzvmYwYuRgYGBiYGVmwAoC0lxTGByeGT0zYm7438AQw9zA0AAUZgTJAQDk9QxHeJxjYGBgZWBgYAZiHSBmYWBgDGFgZAABP6AoI1icmYELLM7CoARWwwISf2b0/z+MBPJZwCQDIxvDKOABkzJQHjisIJiBEQCjLgoxAHicHY3BTsJAGIR3drv/0hZaqXVLIKJSugVNQAOUxCKYeNKLMTHRB+Bi4sGTD2B8GV8C4zNxJepC/vxzmMzMxwRjfz/iW1wzn52xN8YQQLWRzDEdQJA60Co1C5gJhSAzLbZ3BB1TZwgjY2XTaceMixK2UZi8Y2u5Iesb+3ZIl9CJppTyAYaYFFObG21XEp3EI30EzlYbKTernX6B89ALAAFuvARwsiwI7sgPyXBo7p6ffLqe737Eh1K2Wxrifn65bKhKFjXbTtpS6rUu4LvlrFcSwL2y59Dpy/vjQMmZB7HYgRxnq78PwDqSMlpbHM9cv6pk1q3Vbin0KeNdomMDr+4h2W/2uF48+2o03kvhVPpF5gChW7WEoi8SonyIaNloPV3cyPoVZ+wfIBIx1XicY2BkYGAA4r3qZgbx/DZfGbhZGEDg+sL/xxD0/4MsDMwOQC4HAxNIFAA6yguGAHicY2BkYGBu+N/AEMPCAAJAkpEBFTABAEcIAmsEAAAABAAAAAAAAAAArAAAAAEAAAACAHEAAwAAAAAAAgAAAAoACgAAAP8AAAAAAAB4nGWPTU7DMBCFX/oHpBKqqGCH5AViASj9EatuWFRq911036ZOmyqJI8et1ANwHo7ACTgC3IA78EgnmzaWx9+8eWNPANzgBx6O3y33kT1cMjtyDRe4F65TfxBukF+Em2jjVbhF/U3YxzOmwm10YXmD17hi9oR3YQ8dfAjXcI1P4Tr1L+EG+Vu4iTv8CrfQ8erCPuZeV7iNRy/2x1YvnF6p5UHFockikzm/gple75KFrdLqnGtbxCZTg6BfSVOdaVvdU+zXQ+ciFVmTqgmrOkmMyq3Z6tAFG+fyUa8XiR6EJuVYY/62xgKOcQWFJQ6MMUIYZIjK6Og7VWb0r7FDwl57Vj3N53RbFNT/c4UBAvTPXFO6stJ5Ok+BPV8bUnV0K27LnpQ0kV7NSRKyQl7WtlRC6gE2ZVeOEXpc0Yk/KGdI/wAJWm7IAAAAeJxjYGKAAC4G7ICJkYmRmYGrOCMxLz05ozQxj4EBACJZBEAA') format('woff'), url('iconfont.ttf?t=1534844614970') format('truetype'),
                /* chrome, firefox, opera, Safari, Android, iOS 4.2+*/
                url('iconfont.svg?t=1534844614970#iconfont') format('svg');
            /* iOS 4.1- */
        }

        .iconfont {
            font-family: "iconfont" !important;
            font-size: 16px;
            font-style: normal;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .icon-shangchuan:before {
            content: "\e632";
        }


        .iconfont {
            font-family: "iconfont";
            font-size: 18px;
            font-style: normal;
            -webkit-font-smoothing: antialiased;
            -webkit-text-stroke-width: 0.2px;
            -moz-osx-font-smoothing: grayscale;
            padding-left: 20px
        }

        .uploadBox {
            border: 1px solid #ccc;
        }


        .inputfile {
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: -1;
        }

        /*E + F 毗邻元素选择器，匹配所有紧随E元素之后的同级元素F*/

        .inputfile+label {
            color: #3e97df;
            display: inline-block;
        }

        .inputfile:focus+label,
        .inputfile+label:hover {
            color: #0c89f0;
        }

        h3 {
            padding: 10px 0 0 16px;
            font-weight: normal;
            font-size: 18px;
            color: #666;
        }

        .filePart {
            line-height: 30px;
            overflow: hidden;
            float: left;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 12px;
            height: 30px;
        }

        .fileStatus {

            float: left;
            font-size: 10px;

        }

        .ml10 {
            margin-left: 10px;
        }

        .fileName {
            width: 200px;
        }

        .fileSize {
            width: 120px;
            text-align: center;
        }

        .uploadFail {
            color: #ff0800d3;
        }

        .uploadSuccess {
            color: #2c832c;
        }

        /*对应CSS*/

        .progress {
            position: relative;
            width: 80%;
            height: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
            /*注意这里*/
            box-shadow: 0 0 1px 0px #ddd inset;
        }

        .progress span {
            position: absolute;
            display: inline-block;
            width: 10%;
            height: 100%;
            background-color: #3e97df;
        }
    </style>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>

<body>
    <div class="container-fluid px-0" id="app">
        <nav class="navbar navbar-expand-lg navbar-light bg-light " aria-label="breadcrumb">
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="home.html">首页 <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item active ml-3">
                        <a class="nav-link" href="buy.html">买房<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item active ml-3">
                        <a class="nav-link" href="sell.html">售房</a>
                    </li>
                </ul>
                <form v-if="m==0" class="form-inline m-2 my-lg-0">
                    <h class="breadcrumb-item"><a href="Login.html">登录</a></h>
                    <h class="breadcrumb-item"><a href="Register.html">注册</a></h>

                </form>
                <form v-else class="form-inline m-2 my-lg-0">
                    <h class="breadcrumb-item">欢迎您,<a href="userInfo.html" class="text-dark">{{username1}}</a></h>
                    <button v-on:click="exit()" type="button" class="btn btn-outline-secondary btn-sm ml-2">退出</button>
                </form>
            </div>
        </nav>
        <h2 class="card-title text-center my-5">发布出售房源</h2>
        <div class="row">
            <div class="col-lg-8 offset-lg-2">
                <div class="card">
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-lg-2 offset-lg-1">
                                        <span>所在城区</span>
                                    </div>
                                    <div class="col-lg-8">
                                        <div class="form-group">
                                            <select v-model="urban" class="form-control" name="" id="">
                                                <option value="天心">天心</option>
                                                <option value="雨花">雨花</option>
                                                <option value="开福">开福</option>
                                                <option value="岳麓">岳麓</option>
                                                <option value="芙蓉">芙蓉</option>
                                                <option value="浏阳">浏阳</option>
                                                <option value="宁乡">宁乡</option>
                                                <option value="望城">望城</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-lg-2 offset-lg-1">
                                        <span>小区名称</span>
                                    </div>
                                    <div class="col-lg-8">
                                        <input v-model="name" style="border-bottom: 1px solid #dbdbdb;
                                    border-top:0px;
                                    border-left:0px;
                                    border-right:0px" type="text" class="form-control" name="" id=""
                                            aria-describedby="helpId" placeholder="请输入小区名或楼盘">
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-lg-2 offset-lg-1">
                                        <span>具体位置</span>
                                    </div>
                                    <div class="col-lg-8">
                                        <input v-model="address" style="border-bottom: 1px solid #dbdbdb;
                                        border-top:0px;
                                        border-left:0px;
                                        border-right:0px" type="text" class="form-control" name="" id=""
                                            aria-describedby="helpId" placeholder="详细地址： 如道路、门牌号、单元室等">
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-lg-2 offset-lg-1">
                                        <span>栋阁房号</span>
                                    </div>
                                    <div class="col-lg-8">
                                        <input v-model="num" style="border-bottom: 1px solid #dbdbdb;
                                     border-top:0px;
                                     border-left:0px;
                                     border-right:0px" type="text" class="form-control" name="" id=""
                                            aria-describedby="helpId" placeholder="您的楼栋号和门牌号">
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-lg-2 offset-lg-1">
                                        <span>户型</span>
                                    </div>
                                    <div class="col-lg-8">
                                        <div class="row">
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <select v-model="room" class="form-control" name="" id="">
                                                        <option value="1">1室</option>
                                                        <option value="2">2室</option>
                                                        <option value="3">3室</option>
                                                        <option value="4">4室</option>
                                                        <option value="5">5室</option>
                                                        <option value="6">6室</option>
                                                        <option value="7">7室</option>
                                                        <option value="8">8室</option>
                                                        <option value="9">9室</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <select v-model="hall" class="form-control" name="" id="">
                                                        <option value="0">0厅</option>
                                                        <option value="1">1厅</option>
                                                        <option value="2">2厅</option>
                                                        <option value="3">3厅</option>
                                                        <option value="4">4厅</option>
                                                        <option value="5">5厅</option>
                                                        <option value="6">6厅</option>
                                                        <option value="7">7厅</option>
                                                        <option value="8">8厅</option>
                                                        <option value="9">9厅</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <select v-model="guard" class="form-control" name="" id="">
                                                        <option value="0">0卫</option>
                                                        <option value="1">1卫</option>
                                                        <option value="2">2卫</option>
                                                        <option value="3">3卫</option>
                                                        <option value="4">4卫</option>
                                                        <option value="5">5卫</option>
                                                        <option value="6">6卫</option>
                                                        <option value="7">7卫</option>
                                                        <option value="8">8卫</option>
                                                        <option value="9">9卫</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-lg-2 offset-lg-1">
                                        <span>建筑面积</span>
                                    </div>
                                    <div class="col-lg-8">
                                        <div class="input-group mb-3">
                                            <input v-model="size" type="text" class="form-control" style="border-bottom: 1px solid #dbdbdb;
                                                    border-top:0px;
                                                    border-left:0px;
                                                    border-right:0px;" aria-label="Amount (to the nearest dollar)"
                                                placeholder="您房屋的建筑面积">
                                            <div class="input-group-append">
                                                <span>㎡</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-lg-2 offset-lg-1">
                                        <span>期望价格</span>
                                    </div>
                                    <div class="col-lg-8">
                                        <div class="input-group mb-3">
                                            <input v-model="price" type="text" class="form-control" style="border-bottom: 1px solid #dbdbdb;
                                            border-top:0px;
                                            border-left:0px;
                                            border-right:0px;" aria-label="Amount (to the nearest dollar)"
                                                placeholder="您期望售出的价格">
                                            <div class="input-group-append">
                                                <span>万元</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-lg-2 offset-lg-1">
                                        <span>姓名</span>
                                    </div>
                                    <div class="col-lg-8">
                                        <input v-model="sellerName" style="border-bottom: 1px solid #dbdbdb;
                                      border-top:0px;
                                      border-left:0px;
                                      border-right:0px" type="text" class="form-control" name="" id=""
                                            aria-describedby="helpId" placeholder="如何称呼您">
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-lg-2 offset-lg-1">
                                        <span>手机号</span>
                                    </div>
                                    <div class="col-lg-8">
                                        <input v-model="tel" style="border-bottom: 1px solid #dbdbdb;
                                     border-top:0px;
                                     border-left:0px;
                                     border-right:0px" type="text" class="form-control" name="" id=""
                                            aria-describedby="helpId" placeholder="您的联系方式">
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-lg-2 offset-lg-1">
                                        <span>上传楼盘、房屋图片</span>
                                    </div>
                                    <div class="uploadBox col-lg-8">
                                        <div class="fileBox">
                                            <input type="file" id="myFile" class="inputfile"
                                                @change="handlerUpload($event)">
                                            <label for="myFile" class="mt-1">
                                                <i class="iconfont">&#xe632;</i>点击上传图片(限四张)
                                            </label>
                                        </div>
                                        <ul class="files">
                                            <li v-for="(file, index) in files">
                                                <div class="fileInfo mt-3">
                                                    <div class="fileName filePart">
                                                        {{ file.name }}
                                                    </div>
                                                    <div class="fileSize filePart ml10">
                                                        {{file.size}}
                                                    </div>
                                                    <!--进度条-->
                                                    <div class="progress">
                                                        <span
                                                            :style="{width:file.uploadPercentage,backgroundColor:file.uploadStatus==1 ||file.uploadStatus==2?'':'red'}"></span>
                                                    </div>
                                                    <div class="fileStatus">
                                                        <span v-if="file.uploadStatus == -1"
                                                            class="uploadFail">出错啦，请重新上传或者删除</span>
                                                        <span v-if="file.uploadStatus == 2" class="uploadSuccess">
                                                            已上传</span>
                                                        <span v-if="file.uploadStatus == 1" class="uploadSuccess">
                                                            上传中...</span>
                                                        <span v-if="file.uploadStatus == -2"
                                                            class="uploadFail">出错啦，文件类型不符合要求</span>
                                                        <span v-if="file.uploadStatus == -3"
                                                            class="uploadFail">出错啦，文件大小超出限制</span>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>

                                </div>
                            </li>
                        </ul>
                        <div class="row mt-5">
                            <div class="col-lg-4 m-auto">
                                <button v-on:click="sumbit()" type="button"
                                    class="btn btn-danger btn-lg btn-block">立即提交</button>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="jumbotron jumbotron-fluid mb-0 mt-5 py-1 bg-dark clearfix">
        <div class="container pt-4">
            <h1 class="text-center align-text-bottom text-light" style="font-size: 10px;">Copyright(c)2019
                中南林业科技大学信息与计算科学
                版权所有
            </h1>
        </div>
    </div>

    <script>
        toastr.options = {
            closeButton: true, // 是否显示关闭按钮，（提示框右上角关闭按钮）
            //debug: false, // 是否使用deBug模式
            progressBar: false, // 是否显示进度条，（设置关闭的超时时间进度条）
            positionClass: "toast-top-center", // 设置提示款显示的位置
            onclick: null, // 点击消息框自定义事件 
            showDuration: "300", // 显示动画的时间
            hideDuration: "1000", //  消失的动画时间
            timeOut: "1500", //  自动关闭超时时间 
            extendedTimeOut: "1000", //  加长展示时间
            showEasing: "swing", //  显示时的动画缓冲方式
            hideEasing: "linear", //   消失时的动画缓冲方式
            showMethod: "fadeIn", //   显示时的动画方式
            hideMethod: "fadeOut" //   消失时的动画方式
        };
        new Vue({
            el: '#app',
            data: {
                name: '',
                size: '', //建筑面积
                tel: '',
                num: '', //门牌号
                room: '1', //室
                hall: '0', //厅
                guard: '0', //卫
                sellerName: '',
                price: '',
                urban: '',
                address: '',
                files: [],
                uploadSuccess: 0,
                username1: '',
                m: 0,
            },
            methods: {
                exit:function(){
                    sessionStorage.clear();
                    window.location.href = 'home.html';
                },
                sumbit: function () {
                    if (this.name == '' || this.size == '' || this.tel == '' || this
                        .num == '' || this.sellerName == '' || this.price == '' || this.urban == '' || this
                        .address == '') {
                        console.log(this.sellerName);
                        toastr.error('请将数据填完整');
                    } else if (!this.tel.match(/^1[3,5,7,8,9]\d{9}$/)) {
                        toastr.error('手机格式不正确');
                    } else {
                        axios.post("/add.json", {
                                name: this.name,
                                size: this.size,
                                room: this.room,
                                hall: this.hall,
                                guard: this.guard,
                                tel: this.tel,
                                num: this.num,
                                sellerName: this.sellerName,
                                price: this.price,
                                urban: this.urban,
                                address: this.address,
                            })
                            .then(res => {
                                console.log(res.data);
                                toastr.success("提交成功");
                            })
                            .catch(error => {
                                toastr.error(error.response.data.msg);
                            })
                    }
                },
                handlerUpload: function (e) {
                    //获取选定的文件
                    let tFiles = e.target.files;
                    let len = tFiles.length;
                    for (var i = 0; i < len; i++) {
                        //开始上传每一个文件
                        var item = {
                            name: tFiles[i].name,
                            uploadPercentage: 1,
                            size: this.formatFileSize(tFiles[i].size, 0),
                            uploadStatus: 0
                        }
                        console.log(item)
                        this.files.push(item);
                        //开始上传文件 新建一个formData
                        let param = new FormData();
                        param.append("name", "wiiiiiinney");
                        //通过append向form对象添加数据
                        param.append("file", tFiles[i]);
                        //FormData私有类对象，访问不到，可以通过get判断值是否传进去
                        console.log(param.get("file"));
                        //判断大小
                        if (!this.checkFileSize(tFiles[i].size)) {
                            item.uploadStatus = -3;
                            return false;
                        }
                        if (!this.checkFileType(tFiles[i].name.split('.')[1])) {
                            item.uploadStatus = -2;
                            return false;
                        }
                        //通过axios上传文件
                        //配置
                        let config = {
                            //添加请求头 
                            headers: {
                                "Content-Type": "multipart/form-data"
                            },
                            //添加上传进度监听事件 
                            onUploadProgress: e => {
                                var completeProgress = ((e.loaded / e.total * 100) | 0) + "%";
                                console.log(this.files)
                                item.uploadPercentage = completeProgress;
                            }
                        };
                        axios.post('upload', param, config).then(function (
                            response) {
                            console.log(response);
                            item.uploadStatus = 2;
                        }).catch(function (error) {
                            console.log(error);
                            item.uploadStatus = -1;
                        });
                    }
                },
                formatFileSize: function (fileSize, idx) {
                    var units = ["B", "KB", "MB", "GB"];
                    idx = idx || 0;
                    if (fileSize < 1024 || idx === units.length - 1) {
                        return fileSize.toFixed(1) +
                            units[idx];
                    }
                    return this.formatFileSize(fileSize / 1024, ++idx);
                },
                checkFileType: function (fileType) {
                    const acceptTypes = ['jpg'];
                    for (var i = 0; i < acceptTypes.length; i++) {
                        if (fileType === acceptTypes[i]) {
                            return true;
                        }
                    }
                    return false;
                },
                checkFileSize: function (fileSize) {
                    //2M
                    const MAX_SIZE = 2 * 1024 * 1024;
                    if (fileSize > MAX_SIZE) {
                        return false;
                    }
                    return true;
                }
            },
            mounted() {
                this.username1 = sessionStorage.getItem("username");
                console.log(this.username1);
                if (this.username1 != null) {
                    this.m = 1
                } else {
                    this.m = 0
                }
            },

        })
    </script>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous">
    </script>
</body>

</html>